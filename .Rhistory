View(statename)
View(statename)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(`FIPS Code` = as.character(`FIPS Code`)) %>% mutate(statefips = substr(`FIPS Code`, 1,2), statefips = as.numeric(statefips), `FIPS Code` = as.numeric(`FIPS Code`))
View(statename)
View(statename)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(`FIPS Code` = as.character(`FIPS Code`)) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2), STATEFP = as.numeric(STATEFP), `FIPS Code` = as.numeric(`FIPS Code`))
retail_geon <- left_join(retail_geo, statename, by = STATEFP)
retail_geon %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geon <- left_join(retail_geo, statename, by = STATEFP)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(`FIPS Code` = as.character(`FIPS Code`)) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2), STATEFP = as.numeric(STATEFP), `FIPS Code` = as.numeric(`FIPS Code`))
retail_geon <- left_join(retail_geo, statename, by = STATEFP)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(`FIPS Code` = as.character(`FIPS Code`)) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2), STATEFP = as.numeric(STATEFP), `FIPS Code` = as.numeric(`FIPS Code`))
retail_geon <- left_join(retail_geo, statename, by = STATEFP)
retail_geon <- left_join(retail_geo, statename, by = "STATEFP")
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(`FIPS Code` = as.character(`FIPS Code`)) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2), STATEFP = as.numeric(STATEFP), `FIPS Code` = as.numeric(`FIPS Code`))
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(`FIPS Code` = as.character(`FIPS Code`)) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2)) %>% mutate(STATEFP = as.numeric(STATEFP), `FIPS Code` = as.numeric(`FIPS Code`))
retail_geon <- left_join(retail_geo, statename, by = "STATEFP")
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(`FIPS Code` = as.character(`FIPS Code`)) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
retail_geon <- left_join(retail_geo, statename, by = "STATEFP")
retail_geon %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
View(retail_geon)
View(retail_geon)
glimpse(retail_geon)
knitr::opts_chunk$set(echo = TRUE)
summary(cars)
plot(pressure)
library(tidyverse)
library(readr)
library(sf)
retail <- read_csv("retail_data_export.csv")
vax_data <- read_csv("county_week26_data_fixed.csv", col_types = list(`FIPS Code` = col_character()))
#vax_data$`FIPS Code`<-as.character(vax_data$`FIPS Code`)
store_sf <- st_read("tl_2016_us_county.shp")
glimpse(retail)
glimpse(store_sf)
retail %>% group_by(dayofmonth) %>% summarise(avg_traffic = mean(daily_visitors))
store_sf <- store_sf %>% mutate(GEOID = as.character(GEOID))
store_sf <- st_transform(store_sf, 4326)
retail_data <- st_as_sf(
retail,
coords = c("longitude", "latitude"),
crs = 4326
)
#commit test comment
retail_geo <- st_join(
retail_data,
store_sf,
join = st_within
)
# if you don't remove geometries, summarise will crash. MUST remove geometries
retail_geo$geometry <- NULL
retail_geo %>% group_by(dayofmonth) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = STATEFP)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
retail_geo <- left_join(retail_geo, statename, by = "STATEFP")
retail_geo %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors), State = State) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
View(vax_data)
View(vax_data)
vax_data %>%  filter(length(`FIPS Code`==6))
vax_data %>%  filter(length(`FIPS Code`)==6)
retail_geo <- left_join(retail_geo, statename, by = "STATEFP")
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
knitr::opts_chunk$set(echo = TRUE)
summary(cars)
plot(pressure)
library(tidyverse)
library(readr)
library(sf)
retail <- read_csv("retail_data_export.csv")
vax_data <- read_csv("county_week26_data_fixed.csv", col_types = list(`FIPS Code` = col_character()))
#vax_data$`FIPS Code`<-as.character(vax_data$`FIPS Code`)
store_sf <- st_read("tl_2016_us_county.shp")
glimpse(retail)
glimpse(store_sf)
retail %>% group_by(dayofmonth) %>% summarise(avg_traffic = mean(daily_visitors))
store_sf <- store_sf %>% mutate(GEOID = as.character(GEOID))
store_sf <- st_transform(store_sf, 4326)
retail_data <- st_as_sf(
retail,
coords = c("longitude", "latitude"),
crs = 4326
)
#commit test comment
retail_geo <- st_join(
retail_data,
store_sf,
join = st_within
)
# if you don't remove geometries, summarise will crash. MUST remove geometries
retail_geo$geometry <- NULL
retail_geo %>% group_by(dayofmonth) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = STATEFP)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
retail_geo <- left_join(retail_geo, statename, by = "STATEFP")
retail_geo %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors), State = State) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors), State = State)
retail_geo %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors), State = State)%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = STATEFP)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, State) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, State) %>% summarise(avg_traffic=mean(daily_visitors))
retail_geo %>% group_by(dayofmonth, State) %>% summarise(avg_traffic=mean(daily_visitors, na.rm=TRUE))
gc()
retail_geo %>% group_by(dayofmonth, State) %>% summarise(avg_traffic=mean(daily_visitors, na.rm=TRUE), FIPS = STATEFP)
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors, na.rm=TRUE)
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors, na.rm=TRUE)
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors, na.rm=TRUE))
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = STATEFP)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = STATEFP)) +
geom_vline(mapping = aes(xintercept = 18), color = "red") +
theme(legend.position = "top")
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red") +
theme(legend.position = "top")
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red") +
theme(legend.position = "none")
top_states = retail_geo %>% group_by(dayofmonth, State) %>% summarise(top_avg=max(mean(daily_visitors)))
top_states <- retail_geo %>% group_by(dayofmonth, State) %>% summarise(top_avg=max(mean(daily_visitors)))
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
top_states <- retail_geo %>% group_by(dayofmonth, State) %>% summarise(top_avg=max(mean(daily_visitors))) %>% arrange(desc(top_avg))
View(top_states)
View(top_states)
top_states <- retail_geo %>% group_by(State) %>% summarise(top_avg=max(mean(daily_visitors))) %>% arrange(desc(top_avg))
top_states <- retail_geo %>% group_by(State) %>% summarise(top_avg=max(mean(daily_visitors, na.rm=TRUE))) %>% arrange(desc(top_avg))
View(top_states)
View(top_states)
top_states <- retail_geo %>% group_by(State) %>% summarise(top_avg=max(mean(daily_visitors, na.rm=TRUE))) %>% arrange(desc(top_avg)) %>% head()
top_states <- retail_geo %>% group_by(State) %>% summarise(top_avg=max(mean(daily_visitors, na.rm=TRUE))) %>% arrange(top_avg) %>% head()
bottom_states <- retail_geo %>% group_by(State) %>% summarise(top_avg=max(mean(daily_visitors, na.rm=TRUE))) %>% arrange(top_avg) %>% head()
top_states <- retail_geo %>% group_by(State) %>% summarise(top_avg=max(mean(daily_visitors, na.rm=TRUE))) %>% arrange(desc(top_avg)) %>% head()
View(top_states)
View(top_states)
View(retail_geo)
View(retail_geo)
View(vax_data)
View(vax_data)
View(vax_data)
gc()
View(retail_geo)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(sf)
View(store_sf)
View(retail_data)
View(retail_data)
retail_spatial <- st_join(
retail_data,
store_sf,
join = st_within
)
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
retail_spatial <- left_join(retail_geo, statename, by = "STATEFP")
retail_spatial <- left_join(retail_spatial, statename, by = "STATEFP")
retail_spatial <- st_join(
retail_data,
store_sf,
join = st_within
)
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
retail_spatial <- left_join(retail_spatial, statename, by = "STATEFP")
gc()
retail_spatial <- st_join(
retail_data,
store_sf,
join = st_within
)
View(retail_spatial)
ny_spatial <- retail_spatial %>% filter(STATEFP=="36")
ny_spatial <- retail_spatial %>% filter(STATEFP=="36")
HI_spatial <- retail_spatial %>% filter(STATEFP=="15")
plot(ny_spatial["placekey"])
View(vax_data)
vax_data <- %>% vax_data %>% mutate(svi_fac = factor(`SVI Category`, levels = c("Very Low Vulnerability", "Low Vulnerability", "Moderate Vulnerability", "High Vulnerability", "Very High Vulnerability"), ordered = TRUE))
vax_data <- vax_data %>% mutate(svi_fac = factor(`SVI Category`, levels = c("Very Low Vulnerability", "Low Vulnerability", "Moderate Vulnerability", "High Vulnerability", "Very High Vulnerability"), ordered = TRUE))
View(vax_data)
retail_spatial <- left_join(retail_spatial, vax_data)
retail_spatial <- left_join(retail_spatial, vax_data, by = c("fips", "FIPS Code"))
retail_spatial <- left_join(retail_spatial, vax_data, by = c("fips" = "FIPS Code"))
retail_spatial$fips <- as.character(retail_spatial$fips)
retail_spatial %>% filter(fips==starts_with("0"))
retail_spatial %>% filter(str_detect(fips, "^0")
retail_spatial %>% filter(str_detect(fips, "^0"))
retail_spatial %>% filter(str_detect(fips, "^0"))
retail_spatial$fips <-str_pad(retail_spatial$fips, 5, "left", "0")
retail_spatial %>% filter(str_detect(fips, "^0"))
retail_spatial %>% filter(str_detect(fips, "^0"))
retail_spatial <- st_join(
retail_data,
store_sf,
join = st_within
)
retail_spatial$fips <- as.character(retail_spatial$fips)
retail_spatial %>% filter(length(fips)==4)
retail_spatial <- st_join(
retail_data,
store_sf,
join = st_within
)
retail_spatial %>% mutate(chr_fips = paste(STATEFP, COUNTYFP, ""))
retail_spatial <- left_join(retail_spatial, vax_data, by = c("chr_fips" = "FIPS Code"))
retail_spatial %>% mutate(chr_fips = paste(STATEFP, COUNTYFP, ""))
retail_spatial <- left_join(retail_spatial, vax_data, by = c("chr_fips" = "FIPS Code"))
retail_spatial <- left_join(retail_spatial, vax_data, by = c("chr_fips" = "`FIPS Code`"))
retail_spatial <- retail_spatial %>% mutate(chr_fips = paste(STATEFP, COUNTYFP, ""))
retail_spatial <- left_join(retail_spatial, vax_data, by = c("chr_fips" = "FIPS Code"))
ny_spatial <- retail_spatial %>% filter(STATEFP=="36")
HI_spatial <- retail_spatial %>% filter(STATEFP=="15")
plot(ny_spatial["placekey"])
ny_spatial %>% ggplot() +
geom_sf(mapping = aes(color = placekey))
ny_spatial %>% ggplot() +
geom_sf(mapping = aes(placekey))
retail_spatial <- retail_spatial %>% mutate(chr_fips = paste(STATEFP, COUNTYFP, sep = ""))
retail_spatial <- st_join(
retail_data,
store_sf,
join = st_within
)
retail_spatial <- retail_spatial %>% mutate(chr_fips = paste(STATEFP, COUNTYFP, sep = ""))
retail_spatial <- left_join(retail_spatial, vax_data, by = c("chr_fips" = "FIPS Code"))
ny_spatial %>% ggplot() +
geom_sf(mapping = aes(fill = svi_fac))
ny_spatial <- retail_spatial %>% filter(STATEFP=="36")
HI_spatial <- retail_spatial %>% filter(STATEFP=="15")
plot(ny_spatial["placekey"])
ny_spatial %>% ggplot() +
geom_sf(mapping = aes(fill = svi_fac))
ny_spatial %>% ggplot() +
geom_sf(mapping = aes(color = svi_fac))
View(store_sf)
glimpse(store_sf)
store_sf <- store_sf %>% mutate(chr_fips = paste(STATEFP, COUNTYFP, sep = ""))
vax_spatial <- left_join(store_sf, vax_data, by = c("chr_fips" = "FIPS Code" ))
View(vax_spatial)
View(vax_spatial)
ny_vax <- vax_spatial %>% filter(STATEFP=="36")
plot(ny_vax["svi_fac"])
ny_spatial %>% ggplot() +
geom_sf(mapping = aes(color = svi_fac))
plot(ny_vax["svi_fac"]) + plot(ny_spatial["placekey"])
ny_vax %>% ggplot() +
geom_sf(mapping = aes(color = svi_fac)) +
geom_sf(data = ny_spatial mapping = aes(placekey))
ny_vax %>% ggplot() +
geom_sf(mapping = aes(color = svi_fac)) +
geom_sf(data = ny_spatial mapping = aes())
ny_vax %>% ggplot() +
geom_sf(mapping = aes(color = svi_fac)) +
geom_sf(data = ny_spatial, mapping = aes())
ny_vax %>% ggplot() +
geom_sf(mapping = aes(fill = svi_fac)) +
geom_sf(data = ny_spatial, mapping = aes())
HI_vax <- vax_spatial %>% filter(STATEFP=="15")
hi_spatial <- retail_spatial %>% filter(STATEFP=="15")
hi_vax <- vax_spatial %>% filter(STATEFP=="15")
hi_vax %>% ggplot() +
geom_sf(mapping = aes(fill = svi_fac)) +
geom_sf(data = hi_spatial, mapping = aes())
vax_spatial %>% ggplot() +
geom_sf(mapping = aes(color = svi_fac))
View(top_states)
View(bottom_states)
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo <- st_join(
retail_data,
store_sf,
join = st_within
)
# if you don't remove geometries, summarise will crash. MUST remove geometries
retail_geo$geometry <- NULL
top_states <- retail_geo %>% group_by(State) %>% summarise(top_avg=max(mean(daily_visitors, na.rm=TRUE))) %>% arrange(desc(top_avg)) %>% head()
knitr::opts_chunk$set(echo = TRUE)
summary(cars)
plot(pressure)
library(tidyverse)
library(readr)
library(sf)
retail <- read_csv("retail_data_export.csv")
vax_data <- read_csv("county_week26_data_fixed.csv", col_types = list(`FIPS Code` = col_character()))
#vax_data$`FIPS Code`<-as.character(vax_data$`FIPS Code`)
store_sf <- st_read("tl_2016_us_county.shp")
glimpse(retail)
glimpse(store_sf)
retail %>% group_by(dayofmonth) %>% summarise(avg_traffic = mean(daily_visitors))
store_sf <- store_sf %>% mutate(GEOID = as.character(GEOID))
store_sf <- st_transform(store_sf, 4326)
retail_data <- st_as_sf(
retail,
coords = c("longitude", "latitude"),
crs = 4326
)
#commit test comment
retail_geo <- st_join(
retail_data,
store_sf,
join = st_within
)
# if you don't remove geometries, summarise will crash. MUST remove geometries
retail_geo$geometry <- NULL
retail_geo %>% group_by(dayofmonth) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = STATEFP)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = STATEFP)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
retail_geo <- left_join(retail_geo, statename, by = "STATEFP")
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors, na.rm=TRUE))
top_states <- retail_geo %>% group_by(State) %>% summarise(top_avg=max(mean(daily_visitors, na.rm=TRUE))) %>% arrange(desc(top_avg)) %>% head()
bottom_states <- retail_geo %>% group_by(State) %>% summarise(top_avg=max(mean(daily_visitors, na.rm=TRUE))) %>% arrange(top_avg) %>% head()
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
library(broom)
gc()
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
retail_geo <- left_join(retail_geo, statename, by = "STATEFP")
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
retail_geo <- left_join(retail_geo, statename, by = "STATEFP")
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
retail_geo <- left_join(retail_geo, statename, by = "STATEFP")
View(statename)
View(statename)
retail_geo <- left_join(retail_geo, statename, by = "STATEFP")
glimpse(statename)
vax_data <- read_csv("county_week26_data_fixed.csv", col_types = list(`FIPS Code` = col_character()))
View(vax_data)
glimpse(vax_data)
#vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
#vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
glimpse(statename)
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
#vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
glimpse(statename)
retail_geo <- left_join(retail_geo, statename, by = "STATEFP")
glimpse(retail_geo)
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors, na.rm=TRUE))
retail <- read_csv("retail_data_export.csv")
vax_data <- read_csv("county_week26_data_fixed.csv", col_types = list(`FIPS Code` = col_character()))
#vax_data$`FIPS Code`<-as.character(vax_data$`FIPS Code`)
store_sf <- st_read("tl_2016_us_county.shp")
glimpse(retail)
glimpse(store_sf)
retail %>% group_by(dayofmonth) %>% summarise(avg_traffic = mean(daily_visitors))
library(tidyverse)
library(readr)
library(sf)
library(broom)
retail <- read_csv("retail_data_export.csv")
vax_data <- read_csv("county_week26_data_fixed.csv", col_types = list(`FIPS Code` = col_character()))
#vax_data$`FIPS Code`<-as.character(vax_data$`FIPS Code`)
store_sf <- st_read("tl_2016_us_county.shp")
glimpse(retail)
glimpse(store_sf)
retail %>% group_by(dayofmonth) %>% summarise(avg_traffic = mean(daily_visitors))
retail <- read_csv("retail_data_export.csv")
vax_data <- read_csv("county_week26_data_fixed.csv")
vax_data$`FIPS Code`<-as.character(vax_data$`FIPS Code`)
store_sf <- st_read("tl_2016_us_county.shp")
glimpse(retail)
glimpse(store_sf)
retail %>% group_by(dayofmonth) %>% summarise(avg_traffic = mean(daily_visitors))
store_sf <- store_sf %>% mutate(GEOID = as.character(GEOID))
store_sf <- st_transform(store_sf, 4326)
retail_data <- st_as_sf(
retail,
coords = c("longitude", "latitude"),
crs = 4326
)
#commit test comment
retail_geo <- st_join(
retail_data,
store_sf,
join = st_within
)
retail_geo <- st_join(
retail_data,
store_sf,
join = st_within
)
# if you don't remove geometries, summarise will crash. MUST remove geometries
retail_geo$geometry <- NULL
retail_geo %>% group_by(dayofmonth) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = STATEFP)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
#vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
retail_geo <- left_join(retail_geo, statename, by = "STATEFP")
retail_geo <- st_join(
retail_data,
store_sf,
join = st_within
)
# if you don't remove geometries, summarise will crash. MUST remove geometries
retail_geo$geometry <- NULL
retail_name_test <- left_join(retail_geo, statename, by = "STATEFP")
View(retail_name_test)
glimpse(retail_name_test)
knitr::opts_chunk$set(echo = TRUE)
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors, na.rm=TRUE))
library(tidyverse)
library(readr)
library(sf)
library(broom)
retail_geo %>% group_by(dayofmonth) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
knitr::opts_chunk$set(echo = TRUE)
summary(cars)
plot(pressure)
library(tidyverse)
library(readr)
library(sf)
library(broom)
retail <- read_csv("retail_data_export.csv")
vax_data <- read_csv("county_week26_data_fixed.csv")
vax_data$`FIPS Code`<-as.character(vax_data$`FIPS Code`)
store_sf <- st_read("tl_2016_us_county.shp")
glimpse(retail)
glimpse(store_sf)
retail %>% group_by(dayofmonth) %>% summarise(avg_traffic = mean(daily_visitors))
store_sf <- store_sf %>% mutate(GEOID = as.character(GEOID))
store_sf <- st_transform(store_sf, 4326)
retail_data <- st_as_sf(
retail,
coords = c("longitude", "latitude"),
crs = 4326
)
#commit test comment
retail_geo <- st_join(
retail_data,
store_sf,
join = st_within
)
# if you don't remove geometries, summarise will crash. MUST remove geometries
retail_geo$geometry <- NULL
retail_geo %>% group_by(dayofmonth) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
retail_geo %>% group_by(dayofmonth, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = STATEFP)) +
geom_vline(mapping = aes(xintercept = 18), color = "red")
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
#vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
View(retail_geo)
glimpse(retail_geo)
retail_geo <- retail_geo %>%  mutate(chr_fips = paste(STATEFP, COUNTYFP, sep = ""))
retail_name_test <- left_join(retail_geo, statename, by = c("chr_fips" = "FIPS Code"))
retail_geo <- left_join(retail_geo, statename, by = c("chr_fips" = "FIPS Code"))
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors, na.rm=TRUE))
View(retail_geo)
retail_geo <- st_join(
retail_data,
store_sf,
join = st_within
)
View(retail_name_test)
View(retail_name_test)
# if you don't remove geometries, summarise will crash. MUST remove geometries
retail_geo$geometry <- NULL
#vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2)) %>%  select(STATEFP, State)
retail_name <- left_join(retail_geo, statename, by = STATEFP))
retail_name <- left_join(retail_geo, statename, by = STATEFP)
#vax_data %>%  filter(length(`FIPS Code`)==6)
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2)) %>%  select(STATEFP, State)
retail_name <- left_join(retail_geo, statename, by = STATEFP)
View(retail_geo)
retail_name <- left_join(retail_geo, statename, by = "STATEFP")
#vax_data %>%  filter(length(`FIPS Code`)==6)
#statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2)) %>%  select(STATEFP, State)
statename <- vax_data %>% select(`FIPS Code`, State)
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
#vax_data %>%  filter(length(`FIPS Code`)==6)
#statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2)) %>%  select(STATEFP, State)
statename <- vax_data %>% select(`FIPS Code`, State)
View(statename)
retail_geo <- retail_geo %>%  mutate(chr_fips = paste(STATEFP, COUNTYFP, sep = ""))
retail_name <- left_join(retail_geo, statename, by = c("chr_fips" = "FIPS Code"))
View(retail_name)
retail_geo <- left_join(retail_geo, statename, by = c("chr_fips" = "FIPS Code"))
