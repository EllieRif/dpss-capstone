cases_avg_per_100k>100 & cases_avg_per_100k<=250 ~ 6
))
case_spatial <- case_spatial %>% mutate(covid_risk_fac = factor(covid_case_risk, levels = (1:6), labels = c( "Nearly No Cases", "Very Low Risk", "Low Risk", "Moderate Risk", "High Risk", "Very High Risk"), ordered = TRUE))
case_spatial <- case_spatial %>% group_by(COUNTYFP) %>% mutate(county_risk_avg =mean(cases_avg_per_100k))
case_spatial <- case_spatial %>% mutate(covid_case_risk = case_when(
county_risk_avg>=0 & county_risk_avg<=10 ~ 1,
county_risk_avg>10 & county_risk_avg<=30 ~2,
county_risk_avg>30 & county_risk_avg<=50 ~3,
county_risk_avg>50 & county_risk_avg<=70 ~4,
county_risk_avg>70 & county_risk_avg<=100 ~ 5,
county_risk_avg>100 & county_risk_avg<=250 ~ 6
))
case_spatial <- case_spatial %>% mutate(county_risk_fac = factor(county_risk_avg, levels = (1:6), labels = c( "Nearly No Cases", "Very Low Risk", "Low Risk", "Moderate Risk", "High Risk", "Very High Risk"), ordered = TRUE))
case_spatial %>% group_by(county) %>%  select(date, county, state, county_risk_fac) %>%  arrange(desc(county_risk_fac))
case_spatial <- case_spatial %>% mutate(county_risk_fac = factor(county_risk_avg, levels = (1:6), labels = c( "Nearly No Cases", "Very Low Risk", "Low Risk", "Moderate Risk", "High Risk", "Very High Risk"), ordered = TRUE))
View(case_spatial)
case_spatial$county_risk_fac
case_spatial <- case_spatial %>% group_by(COUNTYFP) %>% mutate(county_risk_avg =mean(cases_avg_per_100k))
case_spatial$county_risk_avg
case_spatial <- case_spatial %>% mutate(covid_case_risk = case_when(
cases_avg_per_100k>=0 & cases_avg_per_100k<=10 ~ 1,
cases_avg_per_100k>10 & cases_avg_per_100k<=30 ~2,
cases_avg_per_100k>30 & cases_avg_per_100k<=50 ~3,
cases_avg_per_100k>50 & cases_avg_per_100k<=70 ~4,
cases_avg_per_100k>70 & cases_avg_per_100k<=100 ~ 5,
cases_avg_per_100k>100 & cases_avg_per_100k<=250 ~ 6
))
case_spatial <- case_spatial %>% mutate(covid_risk_fac = factor(covid_case_risk, levels = (1:6), labels = c( "Nearly No Cases", "Very Low Risk", "Low Risk", "Moderate Risk", "High Risk", "Very High Risk"), ordered = TRUE))
case_spatial <- case_spatial %>% group_by(COUNTYFP) %>% mutate(county_risk_avg =mean(cases_avg_per_100k))
case_spatial <- case_spatial %>% mutate(county_risk_fac = case_when(
county_risk_avg>=0 & county_risk_avg<=10 ~ 1,
county_risk_avg>10 & county_risk_avg<=30 ~2,
county_risk_avg>30 & county_risk_avg<=50 ~3,
county_risk_avg>50 & county_risk_avg<=70 ~4,
county_risk_avg>70 & county_risk_avg<=100 ~ 5,
county_risk_avg>100 & county_risk_avg<=250 ~ 6
))
case_spatial <- case_spatial %>% mutate(county_risk_fac = factor(county_risk_avg, levels = (1:6), labels = c( "Nearly No Cases", "Very Low Risk", "Low Risk", "Moderate Risk", "High Risk", "Very High Risk"), ordered = TRUE))
case_spatial %>% group_by(county) %>%  select(date, county, state, county_risk_fac) %>%  arrange(desc(county_risk_fac))
case_spatial <- case_spatial %>% mutate(county_risk_fac = factor(county_risk_fac, levels = (1:6), labels = c( "Nearly No Cases", "Very Low Risk", "Low Risk", "Moderate Risk", "High Risk", "Very High Risk"), ordered = TRUE))
case_spatial %>% group_by(county) %>%  select(date, county, state, county_risk_fac) %>%  arrange(desc(county_risk_fac))
case_spatial <- case_spatial %>% mutate(covid_case_risk = case_when(
cases_avg_per_100k>=0 & cases_avg_per_100k<=10 ~ 1,
cases_avg_per_100k>10 & cases_avg_per_100k<=30 ~2,
cases_avg_per_100k>30 & cases_avg_per_100k<=50 ~3,
cases_avg_per_100k>50 & cases_avg_per_100k<=70 ~4,
cases_avg_per_100k>70 & cases_avg_per_100k<=100 ~ 5,
cases_avg_per_100k>100 & cases_avg_per_100k<=250 ~ 6
))
case_spatial <- case_spatial %>% mutate(covid_risk_fac = factor(covid_case_risk, levels = (1:6), labels = c( "Nearly No Cases", "Very Low Risk", "Low Risk", "Moderate Risk", "High Risk", "Very High Risk"), ordered = TRUE))
case_spatial <- case_spatial %>% group_by(COUNTYFP) %>% mutate(county_risk_avg =mean(cases_avg_per_100k))
case_spatial <- case_spatial %>% mutate(county_case_fac = case_when(
county_risk_avg>=0 & county_risk_avg<=10 ~ 1,
county_risk_avg>10 & county_risk_avg<=30 ~2,
county_risk_avg>30 & county_risk_avg<=50 ~3,
county_risk_avg>50 & county_risk_avg<=70 ~4,
county_risk_avg>70 & county_risk_avg<=100 ~ 5,
county_risk_avg>100 & county_risk_avg<=250 ~ 6
))
case_spatial <- case_spatial %>% mutate(county_risk_fac = factor(county_case_fac, levels = (1:6), labels = c( "Nearly No Cases", "Very Low Risk", "Low Risk", "Moderate Risk", "High Risk", "Very High Risk"), ordered = TRUE))
case_spatial %>% group_by(county) %>%  select(date, county, state, county_risk_fac) %>%  arrange(desc(county_risk_fac))
case_spatial %>% group_by(county) %>%  summarise(date, county, state, county_risk_fac, county_risk_avg) %>%  arrange(desc(county_risk_fac))
gc()
case_spatial %>% group_by(county) %>%  select(date, county, state, county_risk_fac, county_risk_avg) %>%  arrange(desc(county_risk_fac))
state_avgs %>% ggplot() +
geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = factor(case_quint), group = state)) + facet_wrap(~factor(case_quint, levels = c(1:5), labels = c("Bottom 20%", "20th-40th Percentile", "40th-60th Percentile", "60th-80th Percentile", "Top 20%")))
state_avgs <- retail_cases %>% group_by(state, dayofmonth) %>% summarise(avg_traffic = mean(daily_visitors), avg_cases_state = mean(cases_state),avg_cases_100k_state = mean(cases_100k_state))
#state_avgs <- retail_cases %>% group_by(state, dayofmonth) %>% summarise(avg_traffic = mean(daily_visitors), cases_state, cases_100k_state)
state_avgs <- state_avgs %>% group_by(state) %>% mutate(avg_cases = mean(avg_cases_state), avg_100k = mean(avg_cases_100k_state))
state_avgs <- state_avgs %>% ungroup() %>%  mutate(case_quint = ntile(avg_100k,5))
state_avgs %>% group_by(case_quint) %>% summarise(n=n())
state_avgs %>% group_by(state) %>% summarise(n=n(), q = mean(case_quint))
state_avgs %>% ggplot() +
geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = factor(case_quint), group = state)) + facet_wrap(~factor(case_quint, levels = c(1:5), labels = c("Bottom 20%", "20th-40th Percentile", "40th-60th Percentile", "60th-80th Percentile", "Top 20%")))
retail_geo %>% group_by(dayofmonth, State, STATEFP) %>% summarise(avg_traffic=mean(daily_visitors))%>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, group = State)) +
geom_vline(mapping = aes(xintercept = 18), color = "red") +
theme(legend.position = "none")
ny_vax %>% ggplot() +
geom_sf(mapping = aes(fill = svi_fac)) +
geom_sf(data = ny_spatial, mapping = aes())
hi_vax %>% ggplot() +
geom_sf(mapping = aes(fill = svi_fac)) +
geom_sf(data = hi_spatial, mapping = aes())
View(reg1)
View(reg2)
diff_reg1 <- lm(mask_change ~ cases_avg_per_100k + gop_win + maj_minority + svi_fac + cvac_fac, data = retail_change)
diff_reg1 <- tidy(diff_reg1)
diff_reg2 <- lm(mask_change ~ cases_avg_per_100k + gop_win + maj_minority + `Social Vulnerability Index (SVI)` + `Ability to handle a COVID-19 outbreak (CVAC)`
, data = retail_change)
diff_reg2 <- tidy(diff_reg2)
reg_cases <- lm(mask_change~cases_avg_per_100k, data = retail_change)
reg_cases <- tidy(reg_cases)
reg_cases1 <- lm(mask_change~cases_avg_per_100k + per_gop, data = retail_change)
reg_cases1 <- tidy(reg_cases1)
reg_cases2 <- lm(mask_change~cases_avg_per_100k + gop_win, data = retail_change)
reg_cases2 <- tidy(reg_cases2)
reg_gop <- lm(mask_change ~ per_gop, data = retail_change)
reg_gop <- tidy(reg_gop)
reg_gop1 <- lm(mask_change~per_gop + `Social Vulnerability Index (SVI)` + `Ability to handle a COVID-19 outbreak (CVAC)`, data = retail_change)
reg_gop1 <- tidy(reg_gop1)
View(diff_reg1)
View(diff_reg1)
View(diff_reg2)
View(diff_reg2)
View(reg_gop)
View(reg_gop)
View(reg_gop1)
View(reg3)
View(reg1)
View(reg1)
View(reg1)
View(reg1)
View(reg2)
View(reg3)
View(biggest_jump)
View(biggest_drop_day)
day_drop_states <- unique(biggest_drop_day$state)
wk_drop_states <- unique(biggest_drop_week$state)
wk_drop_states <- unique(biggest_drop_wk$state)
day_drop_states <- c(unique(biggest_drop_day$state))
wk_jump_states <- unique(biggest_jump_wk$state)
day_jump_states <- unique(biggest_jump_day$state)
View(vax_spatial)
vax_spatial$State
View(biggest_drop)
ny_spatial <- retail_spatial %>% filter(STATEFP=="36")
ny_vax <- vax_spatial %>% filter(STATEFP=="36")
ny_case <- case_spatial %>% filter(STATEFP == "36")
hi_spatial <- retail_spatial %>% filter(STATEFP=="15")
hi_vax <- vax_spatial %>% filter(STATEFP=="15")
day_drop_states <- unique(biggest_drop_day$chr_fips)
wk_drop_states <- unique(biggest_drop_wk$chr_fips)
day_jump_states <- unique(biggest_jump_day$chr_fips)
wk_jump_states <- unique(biggest_jump_wk$chr_fips)
wk_jump_spatial<- vax_spatial %>% filter(chr_fips %in% wk_jump_states)
View(biggest_drop)
wk_jump_vax<- vax_spatial %>% filter(chr_fips %in% wk_jump_states)
wk_jump_spatial <- left_join(store_sf, biggest_jump_wk)
day_drop_states
View(biggest_drop)
View(biggest_drop)
biggest_drop %>% select(state, chr_fips)
View(biggest_jump_wk)
View(wk_jump_vax)
mich_point <- week_jump_spatial %>% filter(state == "Michigan") %>% ggplot() +
geom_sf(mapping = aes(size = wkchange))
View(wk_jump_spatial)
wk_jump_spatial <- left_join(store_sf, biggest_jump_wk, by = "placekey")
View(biggest_jump_wk)
View(biggest_jump_wk)
wk_jump_spatial <- left_join(store_sf, biggest_jump_wk, by = "placekey")
mich_hes <- week_jump_vax %>% filter(state == "Michigan") %>% ggplot() +
geom_sf(mapping = aes(color = `Estimated vaccine hesitancy`))
wk_jump_vax<- vax_spatial %>% filter(chr_fips %in% wk_jump_states)
wk_jump_spatial <- left_join(store_sf, biggest_jump_wk, by = "placekey")
wk_jump_spatial <- left_join(store_sf, biggest_jump_wk)
mich_point <- wk_jump_spatial %>% filter(state == "Michigan") %>% ggplot() +
geom_sf(mapping = aes(size = wkchange))
mich_hes <- wk_jump_vax %>% filter(state == "Michigan") %>% ggplot() +
geom_sf(mapping = aes(color = `Estimated vaccine hesitancy`))
View(wk_jump_vax)
mich_hes <- wk_jump_vax %>% filter(state == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(color = `Estimated vaccine hesitancy`))
mich_hes <- wk_jump_vax %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(color = `Estimated vaccine hesitancy`))
mich_point + mich_hes
mich_point + mich_hes
mich_hes <- wk_jump_vax %>% filter(State == "MICHIGAN") %>%
geom_sf(mapping = aes(color = `Estimated vaccine hesitancy`))
mich_point + mich_hes
View(wk_jump_vax)
mich_hes <- wk_jump_vax %>% filter(State == "MICHIGAN") %>%
geom_sf(mapping = aes(color = `Estimated hesitant`))
mich_point + mich_hes
mich_point <- wk_jump_spatial %>% filter(state == "Michigan") %>% ggplot() +
geom_sf(mapping = aes(color = wkchange))
mich_hes <- wk_jump_vax %>% filter(State == "MICHIGAN") %>%
geom_sf(mapping = aes(fill = `Estimated hesitant`))
mich_point + mich_hes
View(wk_jump_spatial)
View(biggest_jump_day)
View(store_sf)
wk_jump_spatial <- retail_spatial %>% filter(chr_fips %in% wk_jump_states, dayofmonth==18)
wk_jump_spatial <- left_join(wk_jump_spatial, biggest_jump_wk)
mich_point <- wk_jump_spatial %>% filter(state == "Michigan") %>% ggplot() +
geom_sf(mapping = aes(color = wkchange))
mich_hes <- wk_jump_vax %>% filter(State == "MICHIGAN") %>%
geom_sf(mapping = aes(fill = `Estimated hesitant`))
mich_point + mich_hes
wk_jump_spatial <- retail_spatial %>% filter(chr_fips %in% wk_jump_states, dayofmonth==18)
wk_jump_spatial <- left_join(wk_jump_spatial, biggest_jump_wk, by = "placekey")
mich_point <- wk_jump_spatial %>% filter(state == "Michigan") %>% ggplot() +
geom_sf(mapping = aes(color = wkchange))
mich_point + mich_hes
mich_point
mich_point <- wk_jump_spatial %>% filter(state == "Michigan") %>% ggplot() +
geom_sf(mapping = aes(size = wkchange), color = "red")
mich_point
mich_point + mich_hes
mich_hes +mich_point
mich_hes + mich_point
ggplot() + mich_hes + mich_point
geom_sf(mapping = aes(size = wkchange), color = "red")
mich_hes <- wk_jump_vax %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`))
mich_hes + mich_point
geom_sf(mapping = aes(size = wkchange), color = "red")
mich_hes <- wk_jump_vax %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`))
mich_hes + mich_point
+ geom_sf(mapping = aes(size = wkchange), color = "red")
mich_point <- wk_jump_spatial %>% filter(state == "Michigan") %>%  geom_sf(mapping = aes(size = wkchange), color = "red")
mich_hes + mich_point
mich_hes <- wk_jump_vax %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(color = `Estimated hesitant`))
mich_hes + mich_point
mich_hes <- wk_jump_vax %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`))
mich_hes + mich_point
mich_hes <- vax_spatial %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`))
mich_hes + mich_point
mich_hes <- vax_spatial %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`)) + scale_color_brewer(pallette = "Pastel2")
mich_hes <- vax_spatial %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`)) + scale_color_brewer("Pastel2")
mich_point <- wk_jump_spatial %>% filter(state == "Michigan") %>%  geom_sf(mapping = aes(color = wkchange))
mich_hes + mich_point
mich_hes <- vax_spatial %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`)) + scale_color_distiller("Pastel2")
mich_hes + mich_point
mich_hes <- vax_spatial %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`)) + scale_color_distiller(palette = "Pastel2")
mich_hes + mich_point
mich_hes + scale_color_distiller(palette = "Pastel2") +  mich_point
mich_hes
mich_hes <- vax_spatial %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(color = `Estimated hesitant`)) + scale_color_distiller(palette = "Pastel2")
mich_hes
mich_hes + mich_point
mich_hes <- vax_spatial %>% filter(State == "MICHIGAN") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`)) + scale_fill_distiller(palette = "OrRd")
mich_hes + mich_point
View(biggest_jump_wk)
mont_point <- wk_jump_spatial %>% filter(state == "Montana") %>%  geom_sf(mapping = aes(color = wkchange))
mont_hes <- vax_spatial %>% filter(State == "MONTANA") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`)) + scale_fill_distiller(palette = "OrRd")
mont_hes+mont_point
kent_hes+kent_point
kent_point <- wk_jump_spatial %>% filter(state == "Kentucky") %>%  geom_sf(mapping = aes(color = wkchange))
kent_hes <- vax_spatial %>% filter(State == "Kentucky") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`)) + scale_fill_distiller(palette = "OrRd")
kent_hes+kent_point
kent_hes <- vax_spatial %>% filter(State == "KENTUCKY") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`)) + scale_fill_distiller(palette = "OrRd")
kent_hes+kent_point
wk_drop_spatial <- retail_spatial %>% filter(chr_fips %in% wk_drop_states, dayofmonth==18)
wk_drop_spatial <- left_join(wk_jump_spatial, biggest_drop_wk, by = "placekey")
unique(biggest_drop_wk$State)
maine_hes+maine_point
maine_point <- wk_drop_spatial %>% filter(state == "Maine") %>%  geom_sf(mapping = aes(color = wkchange))
wk_drop_spatial <- retail_spatial %>% filter(chr_fips %in% wk_drop_states, dayofmonth==18)
wk_drop_spatial <- left_join(wk_jump_spatial, biggest_drop_wk, by = "placekey")
unique(biggest_drop_wk$State)
maine_point <- wk_drop_spatial %>% filter(state == "Maine") %>%  geom_sf(mapping = aes(color = wkchange))
wk_drop_spatial <- left_join(wk_drop_spatial, biggest_drop_wk, by = "placekey")
unique(biggest_drop_wk$State)
maine_point <- wk_drop_spatial %>% filter(state == "Maine") %>%  geom_sf(mapping = aes(color = wkchange))
maine_hes <- vax_spatial %>% filter(State == "MAINE") %>% ggplot() +
geom_sf(mapping = aes(fill = `Estimated hesitant`)) + scale_fill_distiller(palette = "OrRd")
maine_hes+maine_point
maine_point
ggplot() + maine_point
retail_spatial %>% filter(state == "Maine")
View(retail)
View(retail_geo)
retail_geo %>% filter(State == "MAINE")
retail_geo %>% filter(state == "Maine")
retail_spatial %>% filter(state == "Alaska")
retail_spatial %>% filter(state == "New Jersey")
retail_spatial %>% filter(STATEFP == "23")
maine_point <- wk_drop_spatial %>% filter(STATEFP == "M23") %>%  geom_sf(mapping = aes(color = wkchange))
maine_hes+maine_point
ggplot() + maine_point
wk_drop_spatial %>% filter(state=="Maine")
state_avgs %>% ggplot() +
geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = factor(case_quint, levels = c(1:5), labels = c("Bottom 20%", "20th-40th Percentile", "40th-60th Percentile", "60th-80th Percentile", "Top 20%")), group = state))
state_avgs <- state_avgs %>% mutate(quint = factor(case_quint, levels = c(1:5), labels = c("Bottom 20%", "20th-40th Percentile", "40th-60th Percentile", "60th-80th Percentile", "Top 20%")))
state_avgs %>% ggplot() +
geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = quint, group = state))
retail_cases %>% group_by(state) %>%  ggplot() + geom_histogram(mapping = aes(state_risk_group))
View(avg_dec)
View(reg1)
View(reg2)
View(retail_vax_vote)
View(reg_gop)
View(reg_gop1)
View(reg_gop1)
View(diff_reg1)
View(diff_reg2)
t.test(retail_indicators$daily_visitors[retail_indicators$wksfrom == "Two Weeks Before"], retail_indicators$daily_visitors[retail_indicators$wksfrom == "One Week Before"])
t.test(retail_indicators$daily_visitors[retail_indicators$wksfrom == "One Week Before"], retail_indicators$daily_visitors[retail_indicators$wksfrom == "One Week After"])
t.test(retail_indicators$daily_visitors[retail_indicators$wksfrom == "One Week After"], retail_indicators$daily_visitors[retail_indicators$wksfrom == "Two Weeks After"])
View(reg3)
state_avgs %>% ggplot() +
geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = quint, group = state)) + labs(title = "Average Store Traffic in May 2021", subtitle = "Grouped by State")
state_avgs %>% ggplot() +
geom_line(mapping = aes(x = dayofmonth, y = avg_traffic, color = quint, group = state)) + labs(title = "Average Store Traffic in May 2021", subtitle = "Grouped by State")
ggsave("Average Traffic By State")
ggsave("Average Traffic By State.png")
retail_geo %>% group_by(dayofmonth) %>% summarise(avg_traffic=mean(daily_visitors)) %>% ggplot() + geom_line(mapping = aes(x = dayofmonth, y = avg_traffic)) +
geom_vline(mapping = aes(xintercept = 18), color = "red") + labs(title = "Average Traffic In May 2021")
ggsave("All Traffic.png")
View(reg1)
View(reg2)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(sf)
library(broom)
library(lubridate)
case_data_counties <- read.csv("us-counties-rolling-cases.csv")
case_data_state <- read.csv("us-states-rolling.csv")
case_data_US <- read.csv("us-rolling-cases.csv")
mobility_2020 <-read.csv("2020_US_Region_Mobility_Report.csv")
mobility_2021 <- read.csv("2021_US_Region_Mobility_Report.csv")
case_data_states <- read.csv("us-states-rolling.csv")
View(case_data_states)
case_data_counties <- read.csv("us-counties-rolling-cases.csv")
case_data_states <- read.csv("us-states-rolling.csv")
case_data_US <- read.csv("us-rolling-cases.csv")
mobility_2020 <-read.csv("2020_US_Region_Mobility_Report.csv")
mobility_2021 <- read.csv("2021_US_Region_Mobility_Report.csv")
View(mobility_2020)
mobility_2020_us <- mobility_2020 %>% filter(sub_region_1 != "")
mobility_2020_us <- mobility_2020 %>% filter(sub_region_1 == "")
mobility_2020_states <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2020_counties <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2!="")
View(mobility_2020_us)
View(mobility_2020_states)
View(case_data_states)
case_data_counties$date <- ymd(case_data_counties$date)
case_data_states$date <- ymd(case_data_states$date)
case_data_US$date <- ymd(case_data_US$date)
case_data_states <- case_data_states %>% separate(geoid, into = c("geoid", "sfips"), sep = "-")
case_data_states$geoid <- NULL
case_data_counties <- case_data_counties %>% separate(geoid, into = c("geoid", "scfips"), sep = "-")
case_data_counties$geoid <- NULL
mobility_2020_us <- mobility_2020 %>% filter(sub_region_1 == "")
mobility_2020_states <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2020_counties <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2!="")
mobility_2021_us <- mobility_2021 %>% filter(sub_region_1 == "")
mobility_2021_states <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2021_counties <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2!="")
mobility_2020$date <- ymd(mobility_2020$date)
mobility_2021$date <- ymd(mobility_2021$date)
mobility_2020_us <- mobility_2020 %>% filter(sub_region_1 == "")
mobility_2020_states <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2020_counties <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2!="")
mobility_2021_us <- mobility_2021 %>% filter(sub_region_1 == "")
mobility_2021_states <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2021_counties <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2!="")
mobility_2020_us %>%  filter(month(date)=="03")
mobility_2020_us %>%  filter(month(date)==03)
mobility_2020_us %>%  filter(month(date)==03) %>% ggplot() + geom_histogram(mapping = aes(x = retail_and_recreation_percent_change_from_baseline))
mobility_2020_us %>%  filter(month(date)==03) %>% ggplot() + geom_line(mapping = aes(x = retail_and_recreation_percent_change_from_baseline))
mobility_2020_us %>%  filter(month(date)==03) %>% ggplot() + geom_line(mapping = aes(y = retail_and_recreation_percent_change_from_baseline))
mobility_2020_us %>%  filter(month(date)==03) %>% ggplot() + geom_line(mapping = aes(y = retail_and_recreation_percent_change_from_baseline, x = date)
# struggling with this one because I'm not sure what to regress it on?
mobility_2020_us %>%  filter(month(date)==03) %>% ggplot() + geom_line(mapping = aes(y = retail_and_recreation_percent_change_from_baseline, x = date)
mobility_2020_us %>%  filter(month(date)==03) %>% ggplot() + geom_line(mapping = aes(y = retail_and_recreation_percent_change_from_baseline, x = date))
mobility_2020_us %>%  filter(month(date)==03) %>% ggplot() + geom_line(mapping = aes(y = grocery_and_pharmacy_percent_change_from_baseline, x = date))
store_sf <- st_read("tl_2016_us_county.shp")
View(store_sf)
vax_data <- read_csv("county_week26_data_fixed.csv")
# fips - vax
vax_data$`FIPS Code`<-as.character(vax_data$`FIPS Code`)
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
# state name
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2)) %>%  select(STATEFP, State)
#joining for statefips
mobility_2020_states <- left_join(mobility_2020_states, statename, by = c("sub_region_1" = "State"))
mobility_2021_states <- left_join(mobility_2020_states, statename, by = c("sub_region_1" = "State"))
state_mobility_geo <- left_join(store_sf, mobility_2020_states, by = "STATEFP")
View(state_mobility_geo)
state_mobility_geo <- left_join(store_sf, mobility_2020_states, by = "STATEFP")
state_mobility_geo %>% filter(month(date)==03, day(date)==12 | day(date)==13) %>% ggplot() +
geom_sf(mapping = aes(fill = grocery_and_pharmacy_percent_change_from_baseline)) +
facet_wrap(~date)
state_mobility_geo %>% filter(month(date)==03, day(date)==12 | day(date)==13)
state_mobility_geo %>% filter(month(date)==03)
View(state_mobility_geo)
state_mobility_geo$date
View(mobility_2020_states)
View(statename)
statename
#storesf
store_sf <- store_sf %>% mutate(GEOID = as.character(GEOID))
store_sf <- st_transform(store_sf, 4326)
# state name
statename <- vax_data %>% select(`FIPS Code`, State)
statename
glimpse(store_sf)
glimpse(statename)
%>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
#dates - cases
case_data_counties$date <- ymd(case_data_counties$date)
library(stringr)
%>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
# state name
statename <- vax_data %>% select(`FIPS Code`, State) %>% mutate(STATEFP = substr(`FIPS Code`, 1,2))
glimpse(statename)
#storesf
store_sf <- store_sf %>% mutate(GEOID = as.character(GEOID))
store_sf <- st_transform(store_sf, 4326)
state_mobility_geo <- left_join(store_sf, mobility_2020_states, by = "STATEFP")
state_mobility_geo %>% filter(month(date)==03)
View(mobility_2021_states)
mobility_2021_states <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2021_states <- left_join(mobility_2020_states, statename, by = c("sub_region_1" = "State"))
mobility_2021_states <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2020_states <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2=="")
#joining for statefips
mobility_2020_states <- left_join(mobility_2020_states, statename, by = c("sub_region_1" = "State"))
View(mobility_2020_states)
filter(mobility_2020, sub_region_1 == "Alabama")
mobility_2020 %>%  filter(sub_region_1 == "Alabama")
statename %>% filter(State == "Alabama")
View(case_data_counties)
case_data_states %>% filter(length(scfips)==4)
case_data_states %>% filter(length(sfips)==4)
case_data_states %>% filter(length(sfips)==1)
# state name
statename <- case_data_states %>% select(sfips, State)
# state name
statename <- case_data_states %>% select(sfips, state)
statename %>% filter(state == "Alabama")
mobility_2020_states <- left_join(mobility_2020_states, statename, by = c("sub_region_1" = "state"))
state_mobility_geo <- left_join(store_sf, mobility_2020_states, by = "sfips")
View(case_data_counties)
# state name
statename <- case_data_counties %>% select(scfips, state) %>% mutate(STATEFP = substr(scfips, 1,2))
mobility_2020 %>%  filter(sub_region_1 == "Alabama")
statename %>% filter(state == "Alabama")
# state name
statename <- case_data_counties %>% select(scfips, state) %>% mutate(STATEFP = substr(scfips, 1,2)) %>% select(state, STATEFP)
mobility_2020_states <- left_join(mobility_2020_states, statename, by = c("sub_region_1" = "state"))
mobility_2021_states <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2021_counties <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2!="")
mobility_2020_states <- left_join(mobility_2020_states, statename, by = c("sub_region_1" = "state"))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(sf)
library(broom)
library(lubridate)
library(stringr)
case_data_counties <- read.csv("us-counties-rolling-cases.csv")
case_data_states <- read.csv("us-states-rolling.csv")
case_data_US <- read.csv("us-rolling-cases.csv")
mobility_2020 <-read.csv("2020_US_Region_Mobility_Report.csv")
mobility_2021 <- read.csv("2021_US_Region_Mobility_Report.csv")
vax_data <- read_csv("county_week26_data_fixed.csv")
store_sf <- st_read("tl_2016_us_county.shp")
#dates - cases
case_data_counties$date <- ymd(case_data_counties$date)
case_data_states$date <- ymd(case_data_states$date)
case_data_US$date <- ymd(case_data_US$date)
#fips - cases
case_data_states <- case_data_states %>% separate(geoid, into = c("geoid", "sfips"), sep = "-")
case_data_states$geoid <- NULL
case_data_counties <- case_data_counties %>% separate(geoid, into = c("geoid", "scfips"), sep = "-")
case_data_counties$geoid <- NULL
#date - mobility
mobility_2020$date <- ymd(mobility_2020$date)
mobility_2021$date <- ymd(mobility_2021$date)
mobility_2020_us <- mobility_2020 %>% filter(sub_region_1 == "")
mobility_2020_states <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2020_counties <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2!="")
mobility_2021_us <- mobility_2021 %>% filter(sub_region_1 == "")
mobility_2021_states <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2021_counties <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2!="")
# fips - vax
vax_data$`FIPS Code`<-as.character(vax_data$`FIPS Code`)
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
case_data_states %>% filter(length(sfips)==1)
# state name
statename <- case_data_counties %>% select(scfips, state) %>% mutate(STATEFP = substr(scfips, 1,2)) %>% select(state, STATEFP)
#joining for statefips
mobility_2020 %>%  filter(sub_region_1 == "Alabama")
statename %>% filter(state == "Alabama")
mobility_2020_states <- left_join(mobility_2020_states, statename, by = c("sub_region_1" = "state"))
case_data_counties %>% filter(length(sfips)==4)
case_data_counties %>% filter(length(scfips)==4)
# state name
statename <- case_data_counties %>% select(scfips, state) %>% mutate(STATEFP = substr(scfips, 1,2)) %>% select(state, STATEFP)
View(mobility_2020_states)
glimpse(case_data_states)
# state name
statename <- case_data_states %>% select(sfips, state)
mobility_2020_states <- left_join(mobility_2020_states, statename, by = c("sub_region_1" = "state"))
mobility_2021_states <- left_join(mobility_2020_states, statename, by = c("sub_region_1" = "state"))
mobility_2021_states <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2=="")
mobility_2021_states <- left_join(mobility_2021_states, statename, by = c("sub_region_1" = "state"))
#storesf
store_sf <- store_sf %>% mutate(GEOID = as.character(GEOID))
store_sf <- st_transform(store_sf, 4326)
state_mobility_geo <- left_join(store_sf, mobility_2020_states, by = c("STATEFP"="sfips")
state_mobility_geo <- left_join(store_sf, mobility_2020_states, by = c("STATEFP"="sfips"))
state_mobility_geo <- left_join(store_sf, mobility_2020_states, by = c("STATEFP"="sfips"))
View(store_sf)
state_mobility_geo <- right_join(store_sf, mobility_2020_states, by = c("STATEFP"="sfips"))
