test_narm$c <- test_narm$c %>% replace_na(0)
}
for (c in names(select(county_cm, co_cases:us_deaths_avg_per_100k))) {
test_narm$c %>% replace_na(0)
}
View(test_narm)
glimpse(test_narm)
for (c in select(county_cm, co_cases:us_deaths_avg_per_100k)) {
test_narm <- test_na_rm %>% mutate(c = replace_na(c,0))
}
test_narm <- test_narm %>% mutate(c = replace_na(c,0))
for (c in vars(county_cm, co_cases:us_deaths_avg_per_100k)) {
test_narm <- test_narm %>% mutate(c = replace_na(c,0))
}
glimpse(test_narm)
for (c in colnames(select(county_cm, co_cases: us_deaths_avg_per_100k))) {
test_narm$c <- replace_na(0)
}
glimpse(test_narm)
test_narm <- county_cm
for (c in colnames(select(county_cm, co_cases: us_deaths_avg_per_100k))) {
test_narm$c <- replace_na(0)
}
test_narm$c <- replace_na(0)
glimpse(test_narm)
test_narm <- county_cm %>% select(co_cases: us_deaths_avg_per_100k)
}
for (c in colnames(test_narm)) {
test_narm$c <- replace_na(0)
}
glimpse(test_narm)
for (c in columns(test_narm)) {
test_narm$c <- replace_na(0)
}
for (c in colnames(test_narm)) {
test_narm[[c]] <- replace_na(0)
}
View(test_narm)
glimpse(test_narm)
test_narm <- county_cm
for (c in case_cols) {
test_narm[[c]] <- replace_na(0)
}
glimpse(test_narm)
for (c in case_cols) {
county_cm[[c]] <- replace_na(0)
}
colnames(county_cm)
nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline~us_cases_avg, data = county_cm)
nat_only <- tidy(nat_only)
View(nat_only)
View(nat_only)
glimpse(county_cm)
county_cm <- county_cm %>% select(-metro_area, -iso_3166_2_code, -place_id, -co_county, -co_state, -us_geoid, -st_sfips, -country_region, -country_region_code)
grocery_pharma <- county_cm %>% select(sub_region1: date, grocery_and_pharmacy_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k)
grocery_pharma <- county_cm %>% select(sub_region_1: date, grocery_and_pharmacy_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k)
glimpse(grocery_pharma)
grocery_pharma %>% filter(is.na(grocery_and_pharmacy_percent_change_from_baseline))
grocery_pharma <- county_cm %>% select(sub_region_1: date, grocery_and_pharmacy_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(grocery_and_pharmacy_percent_change_from_baseline))
grocery_pharma %>% filter(is.na(grocery_and_pharmacy_percent_change_from_baseline))
nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline~us_cases_avg, data = )
nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline~us_cases_avg, data = grocery_pharma)
nat_only <- tidy(nat_only)
View(nat_only)
gp_nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline~us_cases_avg, data = grocery_pharma)
gp_nat_only <- tidy(nat_only)
grocery_pharma$grocery_and_pharmacy_percent_change_from_baseline<-as.double(grocery_and_pharmacy_percent_change_from_baseline)
grocery_pharma$grocery_and_pharmacy_percent_change_from_baseline<-as.double(grocery_pharma$grocery_and_pharmacy_percent_change_from_baseline)
gp_nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline~us_cases_avg, data = grocery_pharma)
gp_nat_only <- tidy(nat_only)
gp_nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline~us_cases_avg, data = grocery_pharma)
View(gp_nat_only)
gp_nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ us_cases, data = grocery_pharma)
gp_nat_only <- tidy(nat_only)
View(gp_nat_only)
View(grocery_pharma)
grocery_pharma %>% group_by(date) %>% summarise(c=sum(us_cases))
# joining onto mobility data because case data is empty in early days
county_cm <- left_join(co_mob, all_cases, by = c("date" = "co_date", "census_fips_code" = "co_scfips"))
county_cm <- county_cm %>% select(-metro_area, -iso_3166_2_code, -place_id, -co_county, -co_state, -us_geoid, -st_sfips, -country_region_code, -country_region)
grocery_pharma <- county_cm %>% select(sub_region_1: date, grocery_and_pharmacy_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(grocery_and_pharmacy_percent_change_from_baseline))
grocery_pharma %>% group_by(date) %>% summarise(c=sum(us_cases))
grocery_pharma %>% group_by(date) %>% summarise(c=sum(us_cases, na.rm=TRUE))
test_narm <- county_cm
for (c in case_cols) {
test_narm[[c]] <- replace_na(0)
}
test_narm %>% group_by(date) %>% filter(year(date)==2021) %>% summarise(c=mean(us_cases))
test_narm <- county_cm
for (c in case_cols) {
test_narm[[c]] <- replace_na(test_narm[[c]],0)
}
test_narm %>% group_by(date) %>% filter(year(date)==2021) %>% summarise(c=mean(us_cases))
grocery_pharma <- test_narm %>% select(sub_region_1: date, grocery_and_pharmacy_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(grocery_and_pharmacy_percent_change_from_baseline))
gp_nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ us_cases, data = grocery_pharma)
gp_nat_only <- tidy(nat_only)
gp_nat_only <- tidy(gp_nat_only)
View(gp_nat_only)
grocery_pharma <- test_narm %>% select(sub_region_1: date, grocery_and_pharmacy_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(grocery_and_pharmacy_percent_change_from_baseline), date>=ymd(2020-6-1))
grocery_pharma <- test_narm %>% select(sub_region_1: date, grocery_and_pharmacy_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(grocery_and_pharmacy_percent_change_from_baseline), date>=ymd(2020-06-01))
grocery_pharma <- test_narm %>% select(sub_region_1: date, grocery_and_pharmacy_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(grocery_and_pharmacy_percent_change_from_baseline), month(date)>=6 | year(date)==2021)
gp_nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ us_cases, data = grocery_pharma)
gp_nat_only <- tidy(gp_nat_only)
View(gp_nat_only)
gp_nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ us_cases_avg, data = grocery_pharma)
gp_nat_only <- tidy(gp_nat_only)
gp_nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ us_cases_avg_per_100k, data = grocery_pharma)
gp_nat_only <- tidy(gp_nat_only)
View(county_cm)
View(county_cm)
gp_state_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ st_cases_avg_per_100k, data = grocery_pharma)
gp_state_only <- tidy(gp_state_only)
View(gp_state_only)
gp_county_only <- tidy(gp_county_only)
gp_state_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ co_cases_avg_per_100k, data = grocery_pharma)
gp_county_only <- tidy(gp_county_only)
gp_state_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ st_cases_avg_per_100k, data = grocery_pharma)
gp_state_only <- tidy(gp_state_only)
gp_county_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ co_cases_avg_per_100k, data = grocery_pharma)
gp_county_only <- tidy(gp_county_only)
View(gp_county_only)
retail_rec <- test_narm %>% select(sub_region_1: date, retail_and_recreation_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(retail_and_recreation_percent_change_from_baseline), month(date)>=6 | year(date)==2021)
rr_nat_only <- lm(retail_and_recreation_percent_change_from_baseline ~ us_cases_avg, data = retail_rec)
rr_st_only <- lm(retail_and_recreation_percent_change_from_baseline ~ st_cases_avg_per_100k, data = retail_rec)
rr_co_only <- lm(retail_and_recreation_percent_change_from_baseline ~ co_cases_avg_per_100k, data = retail_rec)
retail_rec <- test_narm %>% select(sub_region_1: date, retail_and_recreation_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(retail_and_recreation_percent_change_from_baseline), month(date)>=6 | year(date)==2021)
rr_nat_only <- lm(retail_and_recreation_percent_change_from_baseline ~ us_cases_avg_per_100k, data = retail_rec)
rr_st_only <- lm(retail_and_recreation_percent_change_from_baseline ~ st_cases_avg_per_100k, data = retail_rec)
rr_co_only <- lm(retail_and_recreation_percent_change_from_baseline ~ co_cases_avg_per_100k, data = retail_rec)
rr_nat_only <- tidy(rr_nat_only)
rr_co_only <- tidy(rr_co_only)
rr_st_only <- tidy(rr_st_only)
View(rr_st_only)
View(rr_nat_only)
View(rr_co_only)
knitr::opts_chunk$set(echo = TRUE)
summary(cars)
plot(pressure)
library(tidyverse)
library(readr)
library(sf)
library(broom)
library(lubridate)
library(stringr)
library(tidycensus)
library(sp)
library(jsonlite)
case_data_counties <- read.csv("us-counties-rolling-cases.csv")
case_data_states <- read.csv("us-states-rolling.csv")
case_data_US <- read.csv("us-rolling-cases.csv")
mobility_2020 <-read.csv("2020_US_Region_Mobility_Report.csv")
mobility_2021 <- read.csv("2021_US_Region_Mobility_Report.csv")
#vax_data <- read_csv("county_week26_data_fixed.csv")
#store_sf <- st_read("tl_2016_us_county.shp")
#dates - cases
case_data_counties$date <- ymd(case_data_counties$date)
case_data_states$date <- ymd(case_data_states$date)
case_data_US$date <- ymd(case_data_US$date)
#fips - cases
case_data_states <- case_data_states %>% separate(geoid, into = c("geoid", "sfips"), sep = "-")
case_data_states$geoid <- NULL
case_data_counties <- case_data_counties %>% separate(geoid, into = c("geoid", "scfips"), sep = "-")
case_data_counties$geoid <- NULL
#date - mobility
mobility_2020$date <- ymd(mobility_2020$date)
mobility_2021$date <- ymd(mobility_2021$date)
# fips - vax
#vax_data$`FIPS Code`<-as.character(vax_data$`FIPS Code`)
#vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
#case_data_counties %>% filter(length(scfips)==4)
# state name
statename <- case_data_states %>% select(sfips, state) %>% distinct(sfips, state)
#joining for statefips
#mobility_2020 %>%  filter(sub_region_1 == "Alabama")
#statename %>% filter(state == "Alabama")
#storesf
#store_sf <- store_sf %>% mutate(GEOID = as.character(GEOID))
#store_sf <- st_transform(store_sf, 4326)
#improving varnames for easier envirnment readability
us20_mob <- mobility_2020 %>% filter(sub_region_1 == "")
st20_mob <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2=="")  %>% distinct(sub_region_1, date, .keep_all = TRUE)
co20_mob <- mobility_2020 %>% filter(sub_region_1 != "", sub_region_2!="")
us21_mob <- mobility_2021 %>% filter(sub_region_1 == "")
st21_mob <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2=="")  %>% distinct(sub_region_1, date, .keep_all = TRUE)
co21_mob <- mobility_2021 %>% filter(sub_region_1 != "", sub_region_2!="")
#grouped
us_mob <-bind_rows(us20_mob, us21_mob)
st_mob <-bind_rows(st20_mob, st21_mob)
co_mob <- bind_rows(co20_mob, co21_mob)
st20_mob <- left_join(st20_mob, statename, by = c("sub_region_1" = "state"))
st21_mob <- left_join(st21_mob, statename, by = c("sub_region_1" = "state"))
st_mob <- left_join(st_mob, statename, by = c("sub_region_1" = "state"))
vars_dc_2019 <- load_variables(2019, "acs5")
#B01001_001
census_spatial <- get_acs(
variables = "B01001_001",
geography = "state",
year = 2019,
geometry = TRUE
)
# struggling with this one because I'm not sure what to regress it on?
#https://www.ncsolutions.com/covid/a-bulk-buying-tipping-point/
mobility_2020_us %>%  filter(month(date)==03) %>% ggplot() + geom_line(mapping = aes(y = retail_and_recreation_percent_change_from_baseline, x = date))
us20_mob %>%  filter(month(date)==03) %>% ggplot() + geom_line(mapping = aes(y = grocery_and_pharmacy_percent_change_from_baseline, x = date))
# struggling with this one because I'm not sure what to regress it on?
#https://www.ncsolutions.com/covid/a-bulk-buying-tipping-point/
us20_mob %>%  filter(month(date)==03) %>% ggplot() + geom_line(mapping = aes(y = retail_and_recreation_percent_change_from_baseline, x = date))
us20_mob %>%  filter(month(date)==03) %>% ggplot() + geom_line(mapping = aes(y = grocery_and_pharmacy_percent_change_from_baseline, x = date))
extreme_buying <- mobility_2020_states %>% filter(month(date)==3, day(date)>=10, day(date)<=13) %>% distinct(sfips, date, .keep_all = TRUE) %>% select(-sub_region_2, -metro_area, -census_fips_code, -iso_3166_2_code)
extreme_buying <- st20_mob %>% filter(month(date)==3, day(date)>=10, day(date)<=13) %>% distinct(sfips, date, .keep_all = TRUE) %>% select(-sub_region_2, -metro_area, -census_fips_code, -iso_3166_2_code)
#test_distinct <- mobility_2020_states %>% distinct(sfips, date, .keep_all = TRUE)
extreme_311 <- extreme_buying %>% group_by(sfips) %>%  filter(day(date)==11)
state_mobility_geo <- right_join(census_spatial, extreme_buying, by = c("GEOID"="sfips"))
b_lims <- state_mobility_geo %>% st_bbox()
state_mobility_geo %>% filter(day(date)==11) %>% ggplot() +
geom_sf(mapping = aes(fill = grocery_and_pharmacy_percent_change_from_baseline)) + scale_fill_distiller(palette = "YlOrRd", name = "grocery") + xlim(-180,-25)
state_mobility_geo %>%  ggplot() +
geom_sf(mapping = aes(fill = grocery_and_pharmacy_percent_change_from_baseline)) + scale_fill_distiller(palette = "YlOrRd", name = "grocery") + xlim(-180,-25) + facet_wrap(~date)
# grocery/pharma -- others will require controlling for stay-at-home-order
colnames(case_data_US)
colnames(case_data_US) <- paste("us_", colnames(case_data_US), sep = "")
colnames(case_data_states) <- paste("st_", colnames(case_data_states), sep = "")
colnames(case_data_counties) <- paste("co_", colnames(case_data_counties), sep = "")
#us_mc20 <- left_join(us20_mob, case_data_US, by=c("date" = "us_date"))
#us_mc21 <- left_join(us21_mob, case_data_US, by=c("date" = "us_date"))
#state_mc20 <- left_join(st20_mob, case_data_states, by = c(c("date" = "st_date"),c("sub_region_1" = "st_state")))
#state_mc21 <- left_join(st21_mob, case_data_states, by = c(c("date" = "st_date"),c("sub_region_1" = "st_state")))
sc_cases <- left_join(case_data_counties, case_data_states, by = c(c("co_state" = "st_state"), c("co_date" = "st_date")))
sc_cases <- left_join(case_data_counties, case_data_states, by = c(c("co_state" = "st_state"), c("co_date" = "st_date")))
all_cases <- left_join(sc_cases, case_data_US, by = c("co_date" = "us_date"))
co_mob$census_fips_code <- as.character(co_mob$census_fips_code)
co_mob$census_fips_code <- str_pad(co_mob$census_fips_code, 5, "left", "0")
# joining onto mobility data because case data is empty in early days
county_cm <- left_join(co_mob, all_cases, by = c("date" = "co_date", "census_fips_code" = "co_scfips"))
county_cm <- county_cm %>% select(-metro_area, -iso_3166_2_code, -place_id, -co_county, -co_state, -us_geoid, -st_sfips, -country_region_code, -country_region)
case_cols <- county_cm %>% select(co_cases:us_deaths_avg_per_100k) %>% colnames()
test_narm <- county_cm
for (c in case_cols) {
test_narm[[c]] <- replace_na(test_narm[[c]],0)
}
test_narm %>% group_by(date) %>% filter(year(date)==2021) %>% summarise(c=mean(us_cases))
#check on syntax for selecting with brackets and etc BUT IT WORKED
#replace_na(county_cm$co_cases,0)
grocery_pharma <- test_narm %>% select(sub_region_1: date, grocery_and_pharmacy_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(grocery_and_pharmacy_percent_change_from_baseline), month(date)>=6 | year(date)==2021)
#examine randomness of NA for grocery and pharma later--double check it isnt a merge issue
#filtering on date to mitigate against stay at home orders. plan to incorporate fully in future regressions
grocery_pharma$grocery_and_pharmacy_percent_change_from_baseline<-as.double(grocery_pharma$grocery_and_pharmacy_percent_change_from_baseline)
grocery_pharma %>% group_by(date) %>% summarise(c=sum(us_cases, na.rm=TRUE))
gp_nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ us_cases_avg_per_100k, data = grocery_pharma)
gp_nat_only <- tidy(gp_nat_only)
gp_state_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ st_cases_avg_per_100k, data = grocery_pharma)
gp_state_only <- tidy(gp_state_only)
gp_county_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ co_cases_avg_per_100k, data = grocery_pharma)
gp_county_only <- tidy(gp_county_only)
grocery_pharma %>% filter(is.na(grocery_and_pharmacy_percent_change_from_baseline))
retail_rec <- test_narm %>% select(sub_region_1: date, retail_and_recreation_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(retail_and_recreation_percent_change_from_baseline), month(date)>=6 | year(date)==2021)
rr_nat_only <- lm(retail_and_recreation_percent_change_from_baseline ~ us_cases_avg_per_100k, data = retail_rec)
rr_st_only <- lm(retail_and_recreation_percent_change_from_baseline ~ st_cases_avg_per_100k, data = retail_rec)
rr_co_only <- lm(retail_and_recreation_percent_change_from_baseline ~ co_cases_avg_per_100k, data = retail_rec)
rr_nat_only <- tidy(rr_nat_only)
rr_co_only <- tidy(rr_co_only)
rr_st_only <- tidy(rr_st_only)
colnames(grocery_pharma)
grocery_pharma <- grocery_pharma %>% mutate(
state_risk_group = case_when(
st_cases_avg_per_100k>=0 & st_cases_avg_per_100k<=10 ~ 1,
st_cases_avg_per_100k>10 & st_cases_avg_per_100k<=30 ~2,
st_cases_avg_per_100k>30 & st_cases_avg_per_100k<=50 ~3,
st_cases_avg_per_100k>50 & st_cases_avg_per_100k<=70 ~4,
st_cases_avg_per_100k>70 & st_cases_avg_per_100k<=100 ~ 5,
st_cases_avg_per_100k>100 & st_cases_avg_per_100k<=250 ~ 6,
st_cases_avg_per_100k>250 ~ 7
),
national_risk_group = case_when(
us_cases_avg_per_100k>=0 & us_cases_avg_per_100k<=10 ~ 1,
us_cases_avg_per_100k>10 & us_cases_avg_per_100k<=30 ~2,
us_cases_avg_per_100k>30 & us_cases_avg_per_100k<=50 ~3,
us_cases_avg_per_100k>50 & us_cases_avg_per_100k<=70 ~4,
us_cases_avg_per_100k>70 & us_cases_avg_per_100k<=100 ~ 5,
us_cases_avg_per_100k>100 & us_cases_avg_per_100k<=250 ~ 6,
us_cases_avg_per_100k>250 ~ 7
),
county_risk_group = case_when(
co_cases_avg_per_100k>=0 & co_cases_avg_per_100k<=10 ~ 1,
co_cases_avg_per_100k>10 & co_cases_avg_per_100k<=30 ~2,
co_cases_avg_per_100k>30 & co_cases_avg_per_100k<=50 ~3,
co_cases_avg_per_100k>50 & co_cases_avg_per_100k<=70 ~4,
co_cases_avg_per_100k>70 & co_cases_avg_per_100k<=100 ~ 5,
co_cases_avg_per_100k>100 & co_cases_avg_per_100k<=250 ~ 6,
co_cases_avg_per_100k>250 ~ 7
) )
grocery_pharma %>% filter(year(date)==2020) %>% ggplot() +
geom_line(mapping=aes(x = date, y = national_risk_group))
grocery_pharma %>% filter(year(date)==2020) %>% ggplot() +
geom_line(mapping=aes(x = date, y = us_cases_avg_per_100k))
grocery_pharma %>% filter(year(date)==2020) %>% group_by(date) %>% summarise(y = mean(us_cases_avg_per_100k)) %>%  ggplot() +
geom_line(mapping=aes(x = date, y = us_cases_avg_per_100k))
grocery_pharma %>% filter(year(date)==2020) %>% group_by(date) %>% summarise(y = mean(us_cases_avg_per_100k)) %>%  ggplot() +
geom_line(mapping=aes(x = date, y = y))
grocery_pharma %>% group_by(date) %>% summarise(y = mean(us_cases_avg_per_100k)) %>%  ggplot() +
geom_line(mapping=aes(x = date, y = y))
grocery_pharma %>% group_by(date) %>% summarise(y = mean(us_cases_avg_per_100k)) %>%  ggplot() +
geom_line(mapping=aes(x = date, y = y, group = sub_region_1))
grocery_pharma %>% group_by(date, sub_region_1) %>% summarise(y = mean(st_cases_avg_per_100k)) %>%  ggplot() +
geom_line(mapping=aes(x = date, y = y, group = sub_region_1))
grocery_pharma %>% group_by(date) %>% summarise(y = mean(us_cases_avg_per_100k)) %>%  ggplot() +
geom_line(mapping=aes(x = date, y = y))
gp_nat_risk_group <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ national_risk_group, data = grocery_pharma)
gp_nat_risk_group <- tidy(gp_nat_risk_group)
View(gp_nat_risk_group)
gp_nat_risk_group <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ national_risk_group, data = grocery_pharma)
gp_nat_risk_group <- tidy(gp_nat_risk_group)
gp_st_risk_group <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ state_risk_group, data = grocery_pharma)
gp_st_risk_group <- tidy(gp_st_risk_group)
gp_co_risk_group <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ county_risk_group, data = grocery_pharma)
gp_co_risk_group <- tidy(gp_co_risk_group)
View(gp_co_risk_group)
View(gp_st_risk_group)
View(gp_nat_only)
View(gp_nat_risk_group)
gp_nsc <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ us_cases_avg_per_100k + st_cases_avg_per_100k + co_cases_avg_per_100k, data = grocery_pharma)
gp_nsc <- tidy(gp_nsc)
View(gp_nsc)
gp_nsc_risk_group <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ national_risk_group + state_risk_group + county_risk_group, data = grocery_pharma)
gp_nsc_risk_group <- tidy(gp_nsc_risk_group)
View(gp_nsc_risk_group)
retail_rec <- test_narm %>% select(sub_region_1: date, retail_and_recreation_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(retail_and_recreation_percent_change_from_baseline), month(date)>=6 | year(date)==2021)
rr_nat_only <- lm(retail_and_recreation_percent_change_from_baseline ~ us_cases_avg_per_100k, data = retail_rec)
rr_st_only <- lm(retail_and_recreation_percent_change_from_baseline ~ st_cases_avg_per_100k, data = retail_rec)
rr_co_only <- lm(retail_and_recreation_percent_change_from_baseline ~ co_cases_avg_per_100k, data = retail_rec)
rr_nat_only <- tidy(rr_nat_only)
rr_co_only <- tidy(rr_co_only)
rr_st_only <- tidy(rr_st_only)
retail_rec <- retail_rec %>% mutate(
state_risk_group = case_when(
st_cases_avg_per_100k>=0 & st_cases_avg_per_100k<=10 ~ 1,
st_cases_avg_per_100k>10 & st_cases_avg_per_100k<=30 ~2,
st_cases_avg_per_100k>30 & st_cases_avg_per_100k<=50 ~3,
st_cases_avg_per_100k>50 & st_cases_avg_per_100k<=70 ~4,
st_cases_avg_per_100k>70 & st_cases_avg_per_100k<=100 ~ 5,
st_cases_avg_per_100k>100 & st_cases_avg_per_100k<=250 ~ 6,
st_cases_avg_per_100k>250 ~ 7
),
national_risk_group = case_when(
us_cases_avg_per_100k>=0 & us_cases_avg_per_100k<=10 ~ 1,
us_cases_avg_per_100k>10 & us_cases_avg_per_100k<=30 ~2,
us_cases_avg_per_100k>30 & us_cases_avg_per_100k<=50 ~3,
us_cases_avg_per_100k>50 & us_cases_avg_per_100k<=70 ~4,
us_cases_avg_per_100k>70 & us_cases_avg_per_100k<=100 ~ 5,
us_cases_avg_per_100k>100 & us_cases_avg_per_100k<=250 ~ 6,
us_cases_avg_per_100k>250 ~ 7
),
county_risk_group = case_when(
co_cases_avg_per_100k>=0 & co_cases_avg_per_100k<=10 ~ 1,
co_cases_avg_per_100k>10 & co_cases_avg_per_100k<=30 ~2,
co_cases_avg_per_100k>30 & co_cases_avg_per_100k<=50 ~3,
co_cases_avg_per_100k>50 & co_cases_avg_per_100k<=70 ~4,
co_cases_avg_per_100k>70 & co_cases_avg_per_100k<=100 ~ 5,
co_cases_avg_per_100k>100 & co_cases_avg_per_100k<=250 ~ 6,
co_cases_avg_per_100k>250 ~ 7
) )
rr_nat_risk_group <- lm(retail_and_recreation_percent_change_from_baseline ~ national_risk_group, data = retail_rec)
rr_nat_risk_group <- tidy(rr_nat_risk_group)
rr_st_risk_group <- lm(retail_and_recreation_percent_change_from_baseline ~ state_risk_group, data = retail_rec)
rr_st_risk_group <- tidy(rr_st_risk_group)
rr_co_risk_group <- lm(retail_and_recreation_percent_change_from_baseline ~ county_risk_group, data = retail_rec)
rr_co_risk_group <- tidy(rr_co_risk_group)
rr_nsc_risk_group <- lm(retail_and_recreation_percent_change_from_baseline ~ national_risk_group + state_risk_group + county_risk_group, data = retail_rec)
rr_nsc_risk_group <- tidy(rr_nsc_risk_group)
View(rr_nat_risk_group)
View(rr_nsc_risk_group)
#us_mc20 <- left_join(us20_mob, case_data_US, by=c("date" = "us_date"))
#us_mc21 <- left_join(us21_mob, case_data_US, by=c("date" = "us_date"))
#state_mc20 <- left_join(st20_mob, case_data_states, by = c(c("date" = "st_date"),c("sub_region_1" = "st_state")))
#state_mc21 <- left_join(st21_mob, case_data_states, by = c(c("date" = "st_date"),c("sub_region_1" = "st_state")))
sc_cases <- left_join(case_data_counties, case_data_states, by = c(c("co_state" = "st_state"), c("co_date" = "st_date")))
sc_cases <- left_join(case_data_counties, case_data_states, by = c(c("co_state" = "st_state"), c("co_date" = "st_date")))
all_cases <- left_join(sc_cases, case_data_US, by = c("co_date" = "us_date"))
co_mob$census_fips_code <- as.character(co_mob$census_fips_code)
co_mob$census_fips_code <- str_pad(co_mob$census_fips_code, 5, "left", "0")
# joining onto mobility data because case data is empty in early days
county_cm <- left_join(co_mob, all_cases, by = c("date" = "co_date", "census_fips_code" = "co_scfips"))
county_cm <- county_cm %>% select(-metro_area, -iso_3166_2_code, -place_id, -co_county, -co_state, -us_geoid, -st_sfips, -country_region_code, -country_region) %>%  mutate(
state_risk_group = case_when(
st_cases_avg_per_100k>=0 & st_cases_avg_per_100k<=10 ~ 1,
st_cases_avg_per_100k>10 & st_cases_avg_per_100k<=30 ~2,
st_cases_avg_per_100k>30 & st_cases_avg_per_100k<=50 ~3,
st_cases_avg_per_100k>50 & st_cases_avg_per_100k<=70 ~4,
st_cases_avg_per_100k>70 & st_cases_avg_per_100k<=100 ~ 5,
st_cases_avg_per_100k>100 & st_cases_avg_per_100k<=250 ~ 6,
st_cases_avg_per_100k>250 ~ 7
),
national_risk_group = case_when(
us_cases_avg_per_100k>=0 & us_cases_avg_per_100k<=10 ~ 1,
us_cases_avg_per_100k>10 & us_cases_avg_per_100k<=30 ~2,
us_cases_avg_per_100k>30 & us_cases_avg_per_100k<=50 ~3,
us_cases_avg_per_100k>50 & us_cases_avg_per_100k<=70 ~4,
us_cases_avg_per_100k>70 & us_cases_avg_per_100k<=100 ~ 5,
us_cases_avg_per_100k>100 & us_cases_avg_per_100k<=250 ~ 6,
us_cases_avg_per_100k>250 ~ 7
),
county_risk_group = case_when(
co_cases_avg_per_100k>=0 & co_cases_avg_per_100k<=10 ~ 1,
co_cases_avg_per_100k>10 & co_cases_avg_per_100k<=30 ~2,
co_cases_avg_per_100k>30 & co_cases_avg_per_100k<=50 ~3,
co_cases_avg_per_100k>50 & co_cases_avg_per_100k<=70 ~4,
co_cases_avg_per_100k>70 & co_cases_avg_per_100k<=100 ~ 5,
co_cases_avg_per_100k>100 & co_cases_avg_per_100k<=250 ~ 6,
co_cases_avg_per_100k>250 ~ 7
) )
#grouping at high level rather than later
case_cols <- county_cm %>% select(co_cases:us_deaths_avg_per_100k) %>% colnames()
test_narm <- county_cm
for (c in case_cols) {
test_narm[[c]] <- replace_na(test_narm[[c]],0)
}
test_narm %>% group_by(date) %>% filter(year(date)==2021) %>% summarise(c=mean(us_cases))
#check on syntax for selecting with brackets and etc BUT IT WORKED
#replace_na(county_cm$co_cases,0)
grocery_pharma <- test_narm %>% select(sub_region_1: date, grocery_and_pharmacy_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(grocery_and_pharmacy_percent_change_from_baseline), month(date)>=6 | year(date)==2021)
#examine randomness of NA for grocery and pharma later--double check it isnt a merge issue
#filtering on date to mitigate against stay at home orders. plan to incorporate fully in future regressions
grocery_pharma$grocery_and_pharmacy_percent_change_from_baseline<-as.double(grocery_pharma$grocery_and_pharmacy_percent_change_from_baseline)
grocery_pharma %>% group_by(date) %>% summarise(c=sum(us_cases, na.rm=TRUE))
gp_nat_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ us_cases_avg_per_100k, data = grocery_pharma)
gp_nat_only <- tidy(gp_nat_only)
gp_state_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ st_cases_avg_per_100k, data = grocery_pharma)
gp_state_only <- tidy(gp_state_only)
gp_county_only <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ co_cases_avg_per_100k, data = grocery_pharma)
gp_county_only <- tidy(gp_county_only)
gp_nsc <- lm(grocery_and_pharmacy_percent_change_from_baseline ~ us_cases_avg_per_100k + st_cases_avg_per_100k + co_cases_avg_per_100k, data = grocery_pharma)
gp_nsc <- tidy(gp_nsc)
grocery_pharma %>% filter(is.na(grocery_and_pharmacy_percent_change_from_baseline))
retail_rec <- test_narm %>% select(sub_region_1: date, retail_and_recreation_percent_change_from_baseline, co_cases:us_deaths_avg_per_100k) %>% filter(!is.na(retail_and_recreation_percent_change_from_baseline), month(date)>=6 | year(date)==2021)
rr_nat_only <- lm(retail_and_recreation_percent_change_from_baseline ~ us_cases_avg_per_100k, data = retail_rec)
rr_st_only <- lm(retail_and_recreation_percent_change_from_baseline ~ st_cases_avg_per_100k, data = retail_rec)
rr_co_only <- lm(retail_and_recreation_percent_change_from_baseline ~ co_cases_avg_per_100k, data = retail_rec)
rr_nat_only <- tidy(rr_nat_only)
rr_co_only <- tidy(rr_co_only)
rr_st_only <- tidy(rr_st_only)
county_cm[[c]] <- replace_na(county_cm[[c]],0)
glimpse(county_cm)
case_cols <- county_cm %>% select(co_cases:us_deaths_avg_per_100k) %>% colnames()
test_narm <- county_cm
for (c in case_cols) {
county_cm[[c]] <- replace_na(county_cm[[c]],0)
}
test_narm %>% group_by(date) %>% filter(year(date)==2021) %>% summarise(c=mean(us_cases))
#check on syntax for selecting with brackets and etc BUT IT WORKED
#replace_na(county_cm$co_cases,0)
glimpse(county_cm)
county_cm <- county_cm %>%  mutate(
state_risk_group = case_when(
st_cases_avg_per_100k>=0 & st_cases_avg_per_100k<=10 ~ 1,
st_cases_avg_per_100k>10 & st_cases_avg_per_100k<=30 ~2,
st_cases_avg_per_100k>30 & st_cases_avg_per_100k<=50 ~3,
st_cases_avg_per_100k>50 & st_cases_avg_per_100k<=70 ~4,
st_cases_avg_per_100k>70 & st_cases_avg_per_100k<=100 ~ 5,
st_cases_avg_per_100k>100 & st_cases_avg_per_100k<=250 ~ 6,
st_cases_avg_per_100k>250 ~ 7
),
national_risk_group = case_when(
us_cases_avg_per_100k>=0 & us_cases_avg_per_100k<=10 ~ 1,
us_cases_avg_per_100k>10 & us_cases_avg_per_100k<=30 ~2,
us_cases_avg_per_100k>30 & us_cases_avg_per_100k<=50 ~3,
us_cases_avg_per_100k>50 & us_cases_avg_per_100k<=70 ~4,
us_cases_avg_per_100k>70 & us_cases_avg_per_100k<=100 ~ 5,
us_cases_avg_per_100k>100 & us_cases_avg_per_100k<=250 ~ 6,
us_cases_avg_per_100k>250 ~ 7
),
county_risk_group = case_when(
co_cases_avg_per_100k>=0 & co_cases_avg_per_100k<=10 ~ 1,
co_cases_avg_per_100k>10 & co_cases_avg_per_100k<=30 ~2,
co_cases_avg_per_100k>30 & co_cases_avg_per_100k<=50 ~3,
co_cases_avg_per_100k>50 & co_cases_avg_per_100k<=70 ~4,
co_cases_avg_per_100k>70 & co_cases_avg_per_100k<=100 ~ 5,
co_cases_avg_per_100k>100 & co_cases_avg_per_100k<=250 ~ 6,
co_cases_avg_per_100k>250 ~ 7
) )
vote_data <- read_csv("vote2020.csv")
vax_data <- read_csv("county_week26_data_fixed.csv")
View(vax_data)
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
vote_data$county_fips <- str_pad(vote_data$county_fips, 5, "left", "0")
glimpse(vax_data)
glimpse(vote_data)
vax_data <- vax_data %>% select(-State, -`County Name`)
vax_vote <- left_join(vote_data, vax_data, by = c("county_fips" = "`FIPS Code`"))
vax_vote <- left_join(vote_data, vax_data, by = c("county_fips" = "`FIPS Code`"))
vax_vote <- left_join(vote_data, vax_data, by = c("county_fips" = "`FIPS Code`"))
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
vote_data$county_fips <- str_pad(vote_data$county_fips, 5, "left", "0")
vax_data <- vax_data %>% select(-State, -`County Name`)
vax_data <- read_csv("county_week26_data_fixed.csv")
vote_data <- read_csv("vote2020.csv")
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
vote_data$county_fips <- str_pad(vote_data$county_fips, 5, "left", "0")
vax_data <- vax_data %>% select(-State, -`County Name`)
vax_vote <- left_join(vote_data, vax_data, by = c("county_fips" = "`FIPS Code`"))
glimpse(vax_data)
vax_data <- read_csv("county_week26_data_fixed.csv")
vote_data <- read_csv("vote2020.csv")
vax_data$`FIPS Code` <- str_pad(vax_data$`FIPS Code`, 5, "left", "0")
vote_data$county_fips <- str_pad(vote_data$county_fips, 5, "left", "0")
vax_data <- vax_data %>% select(-State, -`County Name`)
vax_vote <- left_join(vote_data, vax_data, by = c("county_fips" = "FIPS Code"))
glimpse(county_cm)
cm_vax_vote <- left_join(county_cm, vax_vote, by = c("census_fips_code" = "county_fips"))
glimpse(cm_vax_vote)
cmvv_avg100k <- cm_vax_vote %>%  select(sub_region_1: residential_percent_change_from_baseline, co_cases_avg_per_100k, st_cases_avg_per_100k, us_cases_avg_per_100k, state_risk_group:county_risk_group, votes_gop: `Percent non-Hispanic White`)
cmvv_avg100k <- cmvv_avg100k %>%  mutate(gop_win = ifelse(per_gop>0.5,1,0), maj_minority = ifelse(`Percent non-Hispanic White`<50, 1, 0), svi_fac = factor(`SVI Category`, levels = c("Very Low Vulnerability", "Low Vulnerability", "Moderate Vulnerability", "High Vulnerability", "Very High Vulnerability"), ordered = TRUE), cvac_fac = factor(`CVAC Category`, levels = c("Very Low Vulnerability", "Low Vulnerability", "Moderate Vulnerability", "High Vulnerability", "Very High Vulnerability"), ordered = TRUE))
coef(gp_nsc)
